#!/bin/sh
set -e

source ./globals

cd "$BUSYBOX_SOURCE_CODE_DIR"

PATCH="$BUSYBOX_PATCHES_DIR/wolfbear-dialog_busybox_1.37.0.patch"

echo "Probando parche: $PATCH"

if patch --dry-run --forward -p0 < "$PATCH"; then
    echo "Aplicando parches para ncurses fix en Alpine"
    patch -p1 < "$PATCH"
    echo "El parche fue aplicado exitosamente"
else
    echo "No se pudo aplicar el parche automáticamente."
    echo "Puede que:"
    echo "  - ya esté aplicado parcialmente,"
    echo "  - el código fuente no coincida con la versión esperada,"
    echo "  - o el nivel -p (p1) sea incorrecto."
    exit 1
fi